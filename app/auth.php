<?php function fr ($dir) {$size = 0; foreach (glob(rtrim($dir, '/').'/*', GLOB_NOSORT) as $each) {$size += is_file($each) ? filesize($each) : fr($each); } return $size; } function auth ($string,$url=''){$admins = array("farid"); switch ($string) {case 'foradmin' : require("password_protect.php"); if(!isset($_SESSION['username'])) header("Location: ".SITE_URL."/panel/signinup"); if(in_array($_SESSION['username'],$admins)){} else {header("Location: ".SITE_URL);} break; case 'foruser' : if(!isset($_SESSION['username'])) header("Location: ".SITE_URL."/panel/signinup"); $f = fr ('../panel'); /*if($f<152800 || $f>152950) header("Location: ".SITE_URL."/panel/dashboard");*/ break; case 'forall' :break;case 'gotodashboard' :if(isset($_SESSION['username'])) header("Location: ".SITE_URL."/panel/dashboard");break;}if($string == 'foruser'){global $pdo;if($url!='dashboard'){$sql_online = "INSERT INTO online (username,user_id,time,page,ip) values(?,?,?,?,?)";$q = $pdo->prepare($sql_online);$q->execute(array($_SESSION['username'],$_SESSION['id'],time(),$url,getip()));}$time_check = (time()-20);$sql_online = "UPDATE users set lastseen=? WHERE username=?";$q = $pdo->prepare($sql_online);$q->execute(array(date("Y-m-d H:i:s"),$_SESSION['username']));global $q_online_users;global $online_count;$sql_online_users="SELECT * FROM online WHERE time>".$time_check." group by username ORDER BY time DESC";$q_online_users=$pdo->query($sql_online_users);$online_count = $q_online_users->rowCount();}}?>